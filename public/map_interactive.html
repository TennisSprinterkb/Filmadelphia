<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset='utf-8' />
    <title>Filmadelphia Philly Map</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <!-- jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.1/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.1/mapbox-gl.css' rel='stylesheet' />
    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <!-- <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
          <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Ubuntu+Condensed" rel="stylesheet">
    <!-- icons -->
    <!-- <link href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.css" rel="stylesheet"
        type='text/css'> -->
    <!-- icon made by Freepik from https://www.flaticon.com-->
    <link rel="icon" href="images/clapperboard.png">
    <link href="/styles/styles.css" rel="stylesheet" type="text/css">
    <style>
        * {
    box-sizing: border-box;
}
        body {
            margin: 0;
            padding: 0;
            font-family: 'Ubuntu Condensed', sans-serif;
        }

        #accordion {
            position: absolute;
            left: 0;
            top: 0;
            bottom: 60px;
            width: 40%;
        }

        #map {
            position: fixed;
            right: 0;
            top: 0;
            bottom: 0;
            width: 60%;
        }

        img {
            max-height: 400px;
            max-width: 400px;
        }

        .locationButton  {
            font-size: 1.00em;
        }


        .mapboxgl-popup {
            max-width: 400px;
            font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
        }
        .mapboxgl-popup-content {
            padding: 0px;
            border-radius: 15px;
        }
        .btn-link {
            color: black;
        }
        .btn-link:hover {
            color: black;
            text-decoration: none;
            font-weight: bold;
        }

        footer {
            position: fixed;
            bottom: 0;
            width: 100%;
            height: 60px;
            background-color: #223438;
            color: #999999;
            padding: 10px;
        }
        .footer-link {
            color: #999999;
        }

        /* commented out navbar because I couldnt get it to function properly */
        .navbar-brand {
            color: black;
            z-index: 100;

        }
    </style>
</head>

<body>
    <div id='accordion'></div>
    <div id='map'></div>

    <footer class="footer">
        <div class="container text-center">
          <p><a class="footer-link" href="/creators">Learn more about the Creators</a>&nbsp;&nbsp;|&nbsp;&nbsp;<a class="footer-link" href="/members">Go Back to Survey&nbsp;&nbsp;|&nbsp;&nbsp;<a class="footer-link" href="/resources">Useful Information and Fun Stuff</a> </p>
        </div>
    
      </footer>
    <script>
       

        $.get("/api/users").then(function (data) {
       
            var movieChosen = data.movie;

            // There are three movies with three locations each as a GeoJSON
            var featureArray = [{
                "type": "Feature",
                "properties": {
                    "title": "Rocky's apartment",
                    "movie": "Rocky",
                    "poster": "https://m.media-amazon.com/images/M/MV5BMTY5MDMzODUyOF5BMl5BanBnXkFtZTcwMTQ3NTMyNA@@._V1_SY1000_CR0,0,666,1000_AL_.jpg",
                    "icon": "star",
                    "descriptionURL": "https://totalrocky.com/filming-location-guide/rockys-apartment.html",
                    "description": "This apartment was the first home that Rocky and Adrian shared.",
                    "image": "https://totalrocky.com/wp-content/uploads/2010/12/guide_aptstreet1.jpg",
                    "colors": ["white", "black"],
                    "mapStyle":"mapbox://styles/mapbox/light-v9"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [-75.124070, 39.990016]
                }
            },
            {
                "type": "Feature",
                "properties": {
                    "title": "Mighty Mick's Gym",
                    "movie": "Rocky",
                    "icon": "star",
                    "descriptionURL": "https://totalrocky.com/filming-location-guide/mighty-micks-gym.html",
                    "description": "The building which stood in for Mighty Mick’s boxing gym never actually was a gym of any kind – all interior scenes of the gym were shot across the country in Los Angeles.",
                    "image": "https://totalrocky.com/wp-content/uploads/2010/12/guide_gym4.jpg"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [-75.132486, 39.982835]
                }
            },
            {
                "type": "Feature",
                "properties": {
                    "title": "Philadelphia Museum of Art",
                    "movie": "Rocky",
                    "icon": "monument",
                    "descriptionURL": "https://totalrocky.com/filming-location-guide/the-philadelphia-museum-of-art.html",
                    "description": "The steps of the Philadelphia Museum of Art are one of the most famous movie locations of all time and a popular tourist attraction.",
                    "image": "https://totalrocky.com/wp-content/uploads/2010/12/guide_steps5.jpg"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [-75.179285, 39.965169]
                }
            },
            {
                "type": "Feature",
                "properties": {
                    "title": "Ben Franklin Bridge",
                    "movie": "National Treasure",
                    "poster": "https://m.media-amazon.com/images/M/MV5BMTY3NTc4OTYxMF5BMl5BanBnXkFtZTcwMjk5NzUyMw@@._V1_SY1000_CR0,0,674,1000_AL_.jpg",
                    "icon": "star",
                    "descriptionURL": "https://www.imdb.com/title/tt0368891/trivia?item=tr3028540",
                    "description": "When the main characters are seen entering Philadelphia, they are crossing on the Benjamin Franklin Bridge, a nod to the Founding Fathers theme in the movie.",
                    "image": "https://upload.wikimedia.org/wikipedia/commons/thumb/6/64/2012_Ben_Franklin_Bridge_and_Race_Street_Pier.jpg/300px-2012_Ben_Franklin_Bridge_and_Race_Street_Pier.jpg",
                    "colors":["white", "#774908"],
                    "mapStyle":"mapbox://styles/mapbox/bright-v9"

                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [-75.134414, 39.952935]
                }
            },
            {
                "type": "Feature",
                "properties": {
                    "title": "Franklin Institute",
                    "movie": "National Treasure",
                    "icon": "museum",
                    "descriptionURL": "http://www.movie-locations.com/movies/n/National-Treasure.php",
                    "description": "The Franklin Institute is a science museum in Philadelphia that also houses much Benjamin Franklin memorabilia.  The main characters find an important clue to the Templar Treasure there in the Silence Dogood letters written by Ben Franklin as a teenager.",
                    "image": "https://assets.visitphilly.com/wp-content/uploads/2018/02/The-Franklin-Institute-Franklin-Statue-J-Fusco-1200VP.jpg"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [-75.172637, 39.958205]
                }
            },
            {
                "type": "Feature",
                "properties": {
                    "title": "Liberty Bell Center",
                    "movie": "National Treasure",
                    "icon": "monument",
                    "descriptionURL": "https://en.wikipedia.org/wiki/Liberty_Bell#Early_days_(1754%E2%80%931846)",
                    "description": "The Liberty Bell was commissioned in 1752 and originally lived in what is now known as Independence Hall.  It now resides at The Liberty Bell Center, at which the second clue to the Templar Treasure is found in the film.",
                    "image": "https://qtxasset.com/styles/breakpoint_sm_default_480px_w/s3/travelagentcentral/1546011003/libertybellgetty.jpg?.q5tpQaV2Mh0m856Sk6GoSOzTsF4cT6q&itok=q-OobNyS"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [-75.150293, 39.949660]
                }
            },
            {
                "type": "Feature",
                "properties": {
                    "title": "2302 St Albans Place",
                    "movie": "The Sixth Sense",
                    "poster": "https://m.media-amazon.com/images/M/MV5BMWM4NTFhYjctNzUyNi00NGMwLTk3NTYtMDIyNTZmMzRlYmQyXkEyXkFqcGdeQXVyMTAwMzUyOTc@._V1_.jpg",
                    "icon": "star",
                    "descriptionURL": "http://www.movie-locations.com/movies/s/Sixth-Sense.php",
                    "description": "The main character who has an ability to see dead people lives on 2302 St. Albans Place with his mother.",
                    "image": "http://www.movie-locations.com/movies/s/SixthSense_StAlbans.jpg",
                    "colors": ["#03080c", "orange"],
                    "mapStyle":"mapbox://styles/akluger/cjt8vk8ib04au1fqmsrkx1x90"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [-75.180895, 39.943145]
                }
            },
            {
                "type": "Feature",
                "properties": {
                    "title": "St. Augustine's Church",
                    "movie": "The Sixth Sense",
                    "icon": "star",
                    "descriptionURL": "http://www.movie-locations.com/movies/s/Sixth-Sense.php",
                    "description": "The main character runs into the St. Augustine's Church when seeking refuge",
                    "image": "http://www.movie-locations.com/movies/s/SixthSense_StAugustine.jpg"
                    
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [-75.146126, 39.955520]
                }
            },
            {
                "type": "Feature",
                "properties": {
                    "title": "Butcher and Singer (Formerly The Striped Bass)",
                    "movie": "The Sixth Sense",
                    "icon": "restaurant",
                    "descriptionURL": "http://www.movie-locations.com/movies/s/Sixth-Sense.php",
                    "description": "The restaurant where Crowe dines with his wife was originally called the Striped Bass, but is now Butcher and Singer",
                    "image": "http://www.movie-locations.com/movies/s/SixthSense_StripedBass.jpg"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [-75.166154, 39.949358]
                }
            },
            {
                "type": "Feature",
                "properties": {
                    "title": "The Duke & Duke Bank (Wells Fargo Building)",
                    "movie": "Trading Places",
                    "poster": "https://m.media-amazon.com/images/M/MV5BYTEzMjBiMzktMjQyMS00YzBhLTgzNWQtNzA0NmEwMTNmMDQ2XkEyXkFqcGdeQXVyNDk3NzU2MTQ@._V1_SY1000_SX675_AL_.jpg",
                    "icon": "town-hall",
                    "descriptionURL": "https://en.wikipedia.org/wiki/Wells_Fargo_Building_(Philadelphia)",
                    "description": "The center of business for the Dukes in the film, this actual bank was built in 1928 and is listed on the National Register of Historic Places",
                    "image": "http://4.bp.blogspot.com/-F853Ijg3TYw/Uejh3WflB9I/AAAAAAAAII0/1Pj38X1ILD0/s1600/DukeAndDuke2_135+S+Broad_TradingPlaces.jpg",
                    "colors": ["#eee2cb","black"],
                    "mapStyle":"mapbox://styles/mapbox/basic-v9"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [-75.170975, 39.918147]
                }
            },
            {
                "type": "Feature",
                "properties": {
                    "title": "Winthorpe Residence (2014 Delancey Place)",
                    "movie": "Trading Places",
                    "icon": "star",
                    "descriptionURL": "https://en.wikipedia.org/wiki/Delancey_Place",
                    "description": "Luxurious home featured in multiple scenes of the film, it is a civil-war era mansion on 'The most filmed block of Philadelphia",
                    "image": "http://2.bp.blogspot.com/-7UeAk_z4XcQ/UejheEV9DOI/AAAAAAAAIIA/dz-XXoRVhng/s1600/AykroydsHouse1_2014+DelanceyPl_TradingPlaces.jpg"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [-75.1748947, 39.9473837]
                }
            },
            {
                "type": "Feature",
                "properties": {
                    "title": "Trading Places Police Station (Community College of Philadelphia)",
                    "movie": "Trading Places",
                    "icon": "police",
                    "descriptionURL": "https://en.wikipedia.org/wiki/Philadelphia_Mint",
                    "description": "Part of an iconic scene when Dan Akroyd's character gets out on bail, this building was originally the Philadelphia Mint and is now part of the Community College",
                    "image": "http://1.bp.blogspot.com/-QCYTcfHUaCQ/Ueji1qlQwTI/AAAAAAAAIJ0/eXp-f3wXV3M/s1600/PoliceSt1_1700+Spring+Garden_TradingPlaces.jpg"

                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [-75.1656502, 39.9624081]
                }
            }
            ];

            // empty array to push the new filtered array if you have a chosen movie from the user survey
            var filteredArray = [];

            // if the user never completed the survey and doesn't have a specific movie listed
            if (movieChosen === "all") {
                filteredArray = featureArray;
            } else { // if the user has a specific movie based on survey results
                for (var i = 0; i < featureArray.length; i++) {
                    if (movieChosen === featureArray[i].properties.movie) {
                        filteredArray.push(featureArray[i]);
                    }
                }
            };

            for (var j = 0; j < filteredArray.length; j++) {
                // This portion below is just jquery to make the information appear on the left side of the screen
                var movieMap = filteredArray[0].properties.mapStyle;
                var movieColor = filteredArray[0].properties.colors[0];
                var fontColor = filteredArray[0].properties.colors[1];
                var movieLocation = "<div class=\"card-header\" id=\"heading" + j + "\"> <h2 class=\"mb-0\"> <button class=\"btn btn-link locationButton\" data-toggle=\"collapse\" data-target=\"#collapse" + j + "\" aria-expanded=\"true\" aria-controls=\"collapse" + j + "\">" + filteredArray[j].properties.title + "</button></h2></div>";
                var movieTitle = "<h1>" + filteredArray[0].properties.movie + "</h1>";
                var moviePoster = "<img style=\"max-height:725px;max-width:500px;\"src=\"" + filteredArray[0].properties.poster + "\"></img>";
                var movieDescription = "<div id=\"collapse" + j + "\" class=\"collapse show\" aria-labelledby=\"heading" + j + "\" data-parent=\"#accordion\"> <div class=\"card-body\">" + filteredArray[j].properties.description + "</div></div>";
                $("#accordion").append("<div class=\"card\">" + movieLocation + movieDescription + "</div>");
                $("#accordion, .card-header, .card-body").css("background-color",movieColor);
                $(".card").css("border", "none");
                $("#accordion, .btn-link, .card-body").css("color",fontColor);
                if (movieChosen === "all")  {
                    moviePoster= "<img style=\"max-height:725px;max-width:500px;\"src=\"https://img.evbuc.com/https%3A%2F%2Fcdn.evbuc.com%2Fimages%2F38670619%2F108919755319%2F1%2Foriginal.jpg?auto=compress&s=2e48dc8c8ff89d4b8a0a267ed8972494\"\"></img>";
                    movieTitle="<h1>Explore The Map!</h1>";
                    movieMap="mapbox://styles/mapbox/bright-v9"
                }
            }
            $("#accordion").prepend("<div class=\"text-center\">" + moviePoster+ "</div>"+"<div class=\"text-center\">" + movieTitle+ "</div>");

      // Public Access token for MapBoxGL (ReadOnly) so not necessary to hide
      mapboxgl.accessToken = 'pk.eyJ1IjoiaXplaW1haSIsImEiOiJjanN2M3o5YnQwMGVwNGFwanRtM2l0bzF5In0.hlOn2QUlP2gW7hYZyxqHHQ';
        // MapBox layer
        var map = new mapboxgl.Map({
            container: 'map', // container id
            // style: 'mapbox://styles/mapbox/streets-v9', // style if you want it to look like google maps-ish
            style: movieMap, //grayscale style
            center: [-75.16, 39.97], // starting position [lng, lat]
            zoom: 12 // starting zoom
        });



            map.on('load', function () {
                map.loadImage('https://upload.wikimedia.org/wikipedia/commons/thumb/6/60/Cat_silhouette.svg/400px-Cat_silhouette.svg.png', function (error, image) {
                    if (error) throw error;
                    map.addImage('cat', image);
                    map.addLayer({
                        "id": "symbols",
                        "type": "symbol",
                        "source": {
                            "type": "geojson",
                            "data": {
                                "type": "FeatureCollection",
                                "features": filteredArray // here is where the filtered GeoJSON is put into the map layer
                            }
                        },
                        "layout": {
                            "icon-image": "{icon}-15", // icon for movie location shows here
                            "text-field": "{title}", // title of the movie location shows here
                            "text-font": ["Open Sans Semibold", "Arial Unicode MS Bold"], // font choices
                            "text-offset": [0, 0.6], // title will appear below the icon
                            "text-anchor": "top"
                        },
                        "paint": {
                            "text-color": fontColor // white color to the text
                        }
                    });

                });

                // Current location of user
                map.addControl(new mapboxgl.GeolocateControl({
                    positionOptions: {
                        enableHighAccuracy: true
                    },
                    trackUserLocation: true
                }));


                // Center the map on the coordinates of any clicked symbol from the 'symbols' layer.
                map.on('click', 'symbols', function (e) {
                    map.flyTo({ center: e.features[0].geometry.coordinates });
                    var image = "<img src=" + e.features[0].properties.image + ">";
                    var coordinates = e.features[0].geometry.coordinates.slice();
                    var description = e.features[0].properties.description;

                    // Ensure that if the map is zoomed out such that multiple
                    // copies of the feature are visible, the popup appears
                    // over the copy being pointed to.
                    while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
                        coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;
                    }

                    // shows image in a popup
                    new mapboxgl.Popup()
                        .setLngLat(coordinates)
                        .setHTML(image)
                        .addTo(map);
                });

                // Change the cursor to a pointer when the it enters a feature in the 'symbols' layer.
                map.on('mouseenter', 'symbols', function () {
                    map.getCanvas().style.cursor = 'pointer';
                });

                // Change it back to a pointer when it leaves.
                map.on('mouseleave', 'symbols', function () {
                    map.getCanvas().style.cursor = '';
                });

            });
        })
    </script>

       
</body>

</html>